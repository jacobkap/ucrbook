# County-Level UCR Data

```{r}
load("data/offenses_known_yearly_1960_2018.rda")

philly <- read_csv("data/jacobdkaplan.com_offenses_count_Philadelphia Police Department_Pennsylvania.csv")
danville <- read_csv("data/jacobdkaplan.com_offenses_count_Danville Police Dept_California.csv")
```

UCR data is only available at the agency-level.^[Even for county-level agencies such as Sheriff's Offices, the data is only for crimes in that agency's jurisdiction. So the county sheriff reports crimes that they responded to but not crimes within the county that other agencies, such as a city police force, responded to.] This has caused a lot of problems for researchers because many variables from other datasets (e.g. CDC data, economic data) is primarily available at the county-level. Their solution to this problem is to aggregate the data to the county-level but summing all the agencies in a particular county. More specifically, nearly all researchers who use this county-level UCR data use the National Archive for Criminal Justice Data (NACJD)'s [datasets](https://www.icpsr.umich.edu/web/pages/NACJD/guides/ucr.html#desc_cl) which have done the aggregation themselves (full disclosure, I used to have my own version of this data available on openICPSR and followed NACJD's method. My reasoning was that people were using it anyways and I wanted to make sure that they knew the problem of the data so I included the issues with this data in the documentation when downloading it. However, I decided that the data was more flawed than I originally though so I took down the data.).^[These files are known on NACJD's website as "Uniform Crime Reporting Program Data: County-Level Detailed Arrest and Offense Data."]

The problem is that not all agencies report data, and even those that do many report only partially (e.g. report fewer than 12 months of the year). So by necessity the missing data has to be filled in somehow. While all methods are imputing missing data are wrong - as they will also be different than the real data, though sometimes not by much - the ways done to impute the missing data in these data are particularly incorrect. We'll go into more detail about why they're incorrect in this chapter. 
In this chapter, rather than talk about the data as it is (as is done in all of the other chapters), I'll talk about why the data is flawed and should never be used. To be clear, all data has measurement errors and much of this book is dedicated to talking about the errors in the other UCR datasets. The problems in the county-level data, however, are egregious enough to merit special warning. This is by no means the first warning about this data. Most famously is [Maltz and Targonski's (2002)](https://link.springer.com/article/10.1023/A:1016060020848) paper in the Journal of Quantitative Criminology about the issues with this data. They concluded that "Until improved methods of imputing county-level crime data are developed, tested, and implemented, they should not be used, especially in policy studies" which is a conclusion I also hold. These warnings, as well as those from others have been largely (it appears) ignored. 

A major reason why I'm dedicating a chapter to this data because it is so widely used. A search on Google Scholar for ["county-level UCR"](https://scholar.google.com/scholar?q=county-level+ucr&hl=en&as_sdt=0,20) returns 3,780 results as of this writing in summer 2021. About half of these results are from 2015 or later. In addition to use by researchers, the county-level UCR data is used by organizations such as the FBI in their annual [Crimes in the United States](https://ucr.fbi.gov/crime-in-the-u.s) report (which is essentially the report that informs the media and the public about crime, even though it's actually only a subset of actual UCR data) and [Social Explorer](https://www.socialexplorer.com/explore-maps), a website that makes it extremely convenient to examine US Census data. Based on my reading of UCR papers there are some differences in data usage by field.^[I used to have a Google Scholar alert for UCR papers but turned it off since so many papers either used my data but didn't cite me, used the data improperly, or both.] This data is most widely used (as a share of papers in the field) by economics researchers (who largely emphasize statistical technique over having good data) and fields other than criminology such as the relatively rare psychologist or political scientist studying crime. Criminologists, however, tend to focus more on agency-level data rather than county-level data, though many criminologists still do use county-level UCR data.^[I note these differences not to join the ego-driven feud between the fields. As a criminologist who currently works in a political science department, these feuds are quite stupid. I note it, however, to show that this data usage is partially driven by subcultures within fields. For example, criminology has long known about - and debated the quality of this data - which may explain why it is more commonly used in non-criminology fields. It is therefore important for researchers to talk to (or collaborate with [though I'm not volunteering or requesting to collaborate with you]) people who have content-expertise about the data that you're using. And that open communication between the fields (including collaborations and submitting to journals from fields other than your own) will strengthen both fields.] 

## Current imputation practices

```{r}
month_to_num <- data.frame(last_month_reported = c(tolower(month.name), "no months reported"),
                           last_month_reported_num = c(1:12, 0))

z <- offenses_known_yearly_1960_2018 %>%
  filter(year %in% 2017) %>%
  mutate(number_of_months_reported = 12 - number_of_months_missing) %>%
  left_join(month_to_num)
table(z$number_of_months_reported)
table(z$last_month_reported_num)
table(z$last_month_reported)

months_table <- data.frame(table(z$last_month_reported_num),
           table(z$number_of_months_reported))
months_table$Var1.1 <- NULL
months_table$percent_change <- months_table$Freq.1 - months_table$Freq
months_table$percent_change <- months_table$percent_change / months_table$Freq * 100
months_table$percent_change <- round(months_table$percent_change, 2)
months_table$percent_change <- pad_decimals(months_table$percent_change, 2)
months_table$percent_change[-grep("-", months_table$percent_change)] <- paste0("+", months_table$percent_change[-grep("-", months_table$percent_change)])

months_table$Freq <- formatC(months_table$Freq, format="d", big.mark=",")
months_table$Freq.1 <- formatC(months_table$Freq.1, format="d", big.mark=",")
names(months_table) <- c("Months Reported",
                         "Last Month Definition",
                         "Months Not Missing Definition", "Percent Change")


knitr::kable(months_table, 
             format = "markdown",
             digits = 2, 
             align = c("l", "r", "r", "r"),
             booktabs = TRUE, 
             longtable = TRUE,
             escape = FALSE,
             caption = "The number of months reported to the 2017 Offenses Known and Clearances by Arrest data using two definitions of months reported. The 'Last Month' definition is the preferred measure of months reported by both the FBI and researchers, though this overcounts months.") %>%
  kable_styling(bootstrap_options = "striped", full_width = FALSE, latex_options = c("hold_position", "repeat_header"))

```


```{r}

data <- philly %>%
  filter(lubridate::year(year) %in% 2018) %>%
  mutate(month = month(year, label = TRUE, abbr = FALSE)) %>%
  select(month,
         actual_murder)

data <- data[match(data$month, month.name), ]
data$imputed_if_missing <- NA

for (i in 1:nrow(data)) {
  rows <- 1:12
  rows <- rows[!rows %in% i]
  data$imputed_if_missing[i] <- sum(data$actual_murder[rows]) * (12/11)
}
new_value <- round(new_value, 2)
data <- data.frame(data)
data$imputed_if_missing <- round(data$imputed_if_missing, 2)
data$annual_murders <- sum(data$actual_murder)
data <- 
  data %>%
  select(month, actual_murder, annual_murders, imputed_if_missing)
data$percent_change <- get_percent_change(data$imputed_if_missing, sum(data$actual_murder))
names(data) <- c("Month", "Murders That Month", "Actual Annual Murder", "Imputed Annual Murder", "Percent Change")

knitr::kable(data, 
             format = "markdown",
             digits = 2, 
             align = c("l", "r", "r", "r", "r"),
             booktabs = TRUE, 
             longtable = TRUE,
             escape = FALSE,
             caption = "The imputed number of murders in Philadelphia in 2018 when missing a single month. This shows how different the imputed value is to the real value for each month missing.") %>%
  kable_styling(bootstrap_options = "striped", full_width = FALSE, latex_options = c("hold_position", "repeat_header"))

```


```{r}

data <- philly %>%
  filter(lubridate::year(year) %in% 2018) %>%
  mutate(month = month(year, label = TRUE, abbr = FALSE)) %>%
  select(month,
         actual_theft_total)

data <- data[match(data$month, month.name), ]
data$imputed_if_missing <- NA

for (i in 1:nrow(data)) {
  rows <- 1:12
  rows <- rows[!rows %in% i]
  data$imputed_if_missing[i] <- sum(data$actual_theft_total[rows]) * (12/11)
}
new_value <- round(new_value, 2)
data <- data.frame(data)
data$imputed_if_missing <- round(data$imputed_if_missing, 2)
data$annual_murders <- sum(data$actual_theft_total)
data <- 
  data %>%
  select(month, actual_theft_total, annual_murders, imputed_if_missing)
data$percent_change <- get_percent_change(data$imputed_if_missing, sum(data$actual_theft_total))
names(data) <- c("Month", "Thefts That Month", "Actual Annual Thefts", "Imputed Annual Thefts", "Percent Change")

knitr::kable(data, 
             format = "markdown",
             digits = 2, 
             align = c("l", "r", "r", "r", "r"),
             booktabs = TRUE, 
             longtable = TRUE,
             escape = FALSE,
             caption = "The imputed number of thefts in Philadelphia in 2018 when missing a single month. This shows how different the imputed value is to the real value for each month missing.") %>%
  kable_styling(bootstrap_options = "striped", full_width = FALSE, latex_options = c("hold_position", "repeat_header"))

```

```{r}

data <- danville %>%
  filter(lubridate::year(year) %in% 2018) %>%
  mutate(month = month(year, label = TRUE, abbr = FALSE)) %>%
  select(month,
         actual_burg_total)

data <- data[match(data$month, month.name), ]
data$imputed_if_missing <- NA

for (i in 1:nrow(data)) {
  rows <- 1:12
  rows <- rows[!rows %in% i]
  data$imputed_if_missing[i] <- sum(data$actual_burg_total[rows]) * (12/11)
}
new_value <- round(new_value, 2)
data <- data.frame(data)
data$imputed_if_missing <- round(data$imputed_if_missing, 2)
data$annual_murders <- sum(data$actual_burg_total)
data <- 
  data %>%
  select(month, actual_burg_total, annual_murders, imputed_if_missing)
data$percent_change <- get_percent_change(data$imputed_if_missing, sum(data$actual_burg_total))
names(data) <- c("Month", "Burglaries That Month", "Actual Annual Burglaries", "Imputed Annual Burglaries", "Percent Change")

knitr::kable(data, 
             format = "markdown",
             digits = 2, 
             align = c("l", "r", "r", "r", "r"),
             booktabs = TRUE, 
             longtable = TRUE,
             escape = FALSE,
             caption = "The imputed number of burglaries in Danville, California, in 2018 when missing a single month. This shows how different the imputed value is to the real value for each month missing.") %>%
  kable_styling(bootstrap_options = "striped", full_width = FALSE, latex_options = c("hold_position", "repeat_header"))

```


```{r}
data <- philly %>%
  filter(lubridate::year(year) %in% 2018) %>%
  mutate(month = month(year, label = TRUE, abbr = FALSE)) %>%
  select(month,
         actual_murder)
data <- data[match(data$month, month.name), ]

final <- data.frame(months_missing = 1:9,
                    actual_murder = sum(data$actual_murder),
                    mean_imputed_murder = NA,
                    median_imputed_murder = NA,
                    mode_imputed_murder = NA,
                    min_imputed_murder = NA,
                    max_imputed_murder = NA)



for (i in 1:9) {
  storage_percent_change <- vector(mode = "numeric", length = 10000)
  for (n in 1:length(storage_percent_change)) {
    months_to_remove <- sample(1:12, i)
    rows <- 1:12
    rows <- rows[!rows %in% months_to_remove]
    storage_percent_change[n] <- sum(data$actual_murder[rows]) * (12/(12-i))
  }
  
  final$mean_imputed_murder[i] <- mean(storage_percent_change)
  final$median_imputed_murder[i] <- median(storage_percent_change)
  final$min_imputed_murder[i] <- min(storage_percent_change)
  final$max_imputed_murder[i] <- max(storage_percent_change)
  final$mode_imputed_murder[i] <- crimeutils:::get_mode(storage_percent_change, return_numeric = TRUE)
}

final <-
  final %>%
  mutate_if(is.numeric, round, 2)

names(final) <- c("# of Months Missing", 
                  "Actual Murder",
                  "Mean Imputed Murder",
                  "Median Imputed Murder",
                  "Modal Imputed Murder",
                  "Min Imputed Murder", 
                  "Max Imputed Murder")

knitr::kable(final, 
             format = "markdown",
             digits = 2, 
             align = c("l", "r", "r", "r", "r", "r", "r"),
             booktabs = TRUE, 
             longtable = TRUE,
             escape = FALSE,
             caption = "A simulation showing how the imputed values of murders in Philadelphia in 2018 changes as the number of months to impute changes. For each number of months missing (and thus, imputed) 10,000 simulations are run for removing and imputing those months of data.") %>%
  kable_styling(bootstrap_options = "striped", full_width = FALSE, latex_options = c("hold_position", "repeat_header"))
```


```{r}
data <- danville %>%
  filter(lubridate::year(year) %in% 2018) %>%
  mutate(month = month(year, label = TRUE, abbr = FALSE)) %>%
  select(month,
         actual_burg_total)
data <- data[match(data$month, month.name), ]

final <- data.frame(months_missing = 1:9,
                    actual_burg_total = sum(data$actual_burg_total),
                    mean_imputed_burglary = NA,
                    median_imputed_burglary = NA,
                    mode_imputed_burglary = NA,
                    min_imputed_burglary = NA,
                    max_imputed_burglary = NA)



for (i in 1:9) {
  storage_percent_change <- vector(mode = "numeric", length = 10000)
  for (n in 1:length(storage_percent_change)) {
    months_to_remove <- sample(1:12, i)
    rows <- 1:12
    rows <- rows[!rows %in% months_to_remove]
    storage_percent_change[n] <- sum(data$actual_burg_total[rows]) * (12/(12-i))
  }
  
  final$mean_imputed_burglary[i] <- mean(storage_percent_change)
  final$median_imputed_burglary[i] <- median(storage_percent_change)
  final$min_imputed_burglary[i] <- min(storage_percent_change)
  final$max_imputed_burglary[i] <- max(storage_percent_change)
  final$mode_imputed_burglary[i] <- crimeutils:::get_mode(storage_percent_change, return_numeric = TRUE)
}

final <-
  final %>%
  mutate_if(is.numeric, round, 2)

names(final) <- c("# of Months Missing",
                  "Actual Burglary",
                  "Mean Imputed Burglary",
                  "Median Imputed Burglary",
                  "Modal Imputed Burglary",
                  "Min Imputed Burglary",
                  "Max Imputed Burglary")

knitr::kable(final, 
             format = "markdown",
             digits = 2, 
             align = c("l", "r", "r", "r", "r", "r", "r"),
             booktabs = TRUE, 
             longtable = TRUE,
             escape = FALSE,
             caption = "A simulation showing how the imputed values of burglaries in Danville, Californoa, in 2018 changes as the number of months to impute changes. For each number of months missing (and thus, imputed) 10,000 simulations are run for removing and imputing those months of data.") %>%
  kable_styling(bootstrap_options = "striped", full_width = FALSE, latex_options = c("hold_position", "repeat_header"))
```


## Possible imputation practices

